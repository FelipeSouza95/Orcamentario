name: ğŸš€ Deploy checklist_tce

on:
  push:
    branches:
      - main

jobs:
  ğŸš¢-deploy-prod:
    name: 'ğŸš¢ Deploy direto em produÃ§Ã£o'
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Clonar repositÃ³rio via IP real (com token)
        run: |
          git config --global user.name "forgejo-ci"
          git config --global user.email "ci@forgejo.local"
          git clone --depth=1 http://${{ secrets.FORGEJO_USER }}:${{ secrets.FORGEJO_TOKEN }}@10.42.88.217:31000/Felipe/checklist-tce repo

      - name: ğŸ› ï¸ Criar .env de produÃ§Ã£o
        working-directory: repo
        run: |
          echo "ENV_ARQUIVO_CHECKLIST_TCE=${{ secrets.ENV_ARQUIVO_CHECKLIST_TCE }}" > .env

      - name: ğŸ›‘ Parar container anterior (checklist_tce)
        run: |
          docker rm -f checklist_tce || true

      - name: ğŸš€ Subir nova versÃ£o do container
        working-directory: repo
        run: |
          docker compose -f docker-compose.yml --project-name checklist_tce up -d --build
